# API QU·∫¢N L√ù KH√ÅCH S·∫°N CHO CH·ª¶ C∆† S·ªû

## üîó **BASE URL**
```
http://localhost:5000
```

## üõ°Ô∏è **AUTHENTICATION**
T·∫•t c·∫£ API c√≥ `Authorization: Bearer <token>` y√™u c·∫ßu JWT token trong header.

## üõ°Ô∏è **PH√ÇN QUY·ªÄN**
- **Admin:** To√†n quy·ªÅn
- **ChuCoSo:** Qu·∫£n l√Ω c∆° s·ªü v√† ph√≤ng c·ªßa m√¨nh
- **KhachHang:** ƒê·∫∑t ph√≤ng, xem th√¥ng tin c√° nh√¢n
- **Public:** Xem c∆° s·ªü v√† ph√≤ng ƒë√£ ƒë∆∞·ª£c duy·ªát

---

## üè¢ **1. QU·∫¢N L√ù C∆† S·ªû L∆ØU TR√ö** `/api/cosoluutru`

### **Xem danh s√°ch c∆° s·ªü**
```http
GET /api/cosoluutru?page=1&pageSize=20&q=search&ownerId=123
```
- **Quy·ªÅn:** Public (ƒë√£ duy·ªát), ChuCoSo (c·ªßa m√¨nh), Admin (t·∫•t c·∫£)
- **Ch·ª©c nƒÉng:** L·∫•y danh s√°ch c∆° s·ªü l∆∞u tr√∫ v·ªõi ph√¢n trang v√† t√¨m ki·∫øm

### **Xem chi ti·∫øt c∆° s·ªü**
```http
GET /api/cosoluutru/{id}
```

### **T·∫°o c∆° s·ªü m·ªõi**
```http
POST /api/cosoluutru
Content-Type: multipart/form-data
Authorization: Bearer <token>

Form data:
- tenCoSo: string (b·∫Øt bu·ªôc)
- moTa: string
- soTaiKhoan: string
- tenTaiKhoan: string
- tenNganHang: string
- soNha: string
- phuong: string
- quan: string  
- thanhPho: string (b·∫Øt bu·ªôc)
- kinhDo: double (t·ªça ƒë·ªô kinh ƒë·ªô)
- viDo: double (t·ªça ƒë·ªô vƒ© ƒë·ªô)
- file: image (optional)
```

**L∆∞u √Ω:** API s·∫Ω t·ª± ƒë·ªông t·∫°o ƒë·ªãa ch·ªâ m·ªõi trong b·∫£ng `DiaChiChiTiet` v√† li√™n k·∫øt v·ªõi c∆° s·ªü l∆∞u tr√∫.

### **C·∫≠p nh·∫≠t c∆° s·ªü**
```http
PUT /api/cosoluutru/{id}
Content-Type: multipart/form-data
Authorization: Bearer <token>

Form data:
- tenCoSo: string
- moTa: string
- soTaiKhoan: string
- tenTaiKhoan: string
- tenNganHang: string
- idDiaChi: int
- file: image (optional)
```

### **X√≥a c∆° s·ªü**
```http
DELETE /api/cosoluutru/{id}
Authorization: Bearer <token>
```

### **Duy·ªát c∆° s·ªü (Admin only)**
```http
PATCH /api/cosoluutru/{id}/approve
Authorization: Bearer <admin_token>
```

### **T·ª´ ch·ªëi c∆° s·ªü (Admin only)**
```http
PATCH /api/cosoluutru/{id}/reject
Content-Type: application/json
Authorization: Bearer <admin_token>

{
  "lyDo": "L√Ω do t·ª´ ch·ªëi"
}
```

### Reverse Geocoding (OpenStreetMap) cho form ƒë·ªãa ch·ªâ
```http
GET /api/cosoluutru/reverse-geocode?lat=21.0278&lng=105.8342
# ho·∫∑c
GET /api/cosoluutru/reverse-geocode?viDo=21.0278&kinhDo=105.8342
```

‚Ä¢ Input: ch·∫•p nh·∫≠n c·∫∑p tham s·ªë `lat/lng` ho·∫∑c `viDo/kinhDo` (d·∫•u ph·∫©y th·∫≠p ph√¢n c≈©ng ƒë∆∞·ª£c).  
‚Ä¢ Output: ƒë·ªãa ch·ªâ th√¢n thi·ªán ƒë·ªÉ auto-fill form. Tr·∫£ v·ªÅ 200 lu√¥n, v·ªõi `success=false` khi kh√¥ng t√¨m th·∫•y chi ti·∫øt.

Response (v√≠ d·ª•):
```json
{
  "success": true,
  "data": {
    "chiTiet": null,
    "pho": "Ph·ªë Tr√†ng Ti·ªÅn",
    "thon": "Th√¥n Trung",
    "phuong": "Ph∆∞·ªùng Tr√†ng Ti·ªÅn", 
    "thanhPho": "H√† N·ªôi",
    "tinhThanh": "H√† N·ªôi",
    "nuoc": "Vi·ªát Nam",
    "displayName": "Ph·ªë Tr√†ng Ti·ªÅn, Ho√†n Ki·∫øm, H√† N·ªôi, Vi·ªát Nam",
    "viDo": 21.0278,
    "kinhDo": 105.8342
  }
}
```

Ghi ch√∫ √°nh x·∫° tr∆∞·ªùng:
- `phuong` (x√£/ph∆∞·ªùng/th·ªã tr·∫•n) ∆∞u ti√™n: `suburb ‚Üí town ‚Üí village ‚Üí hamlet ‚Üí neighbourhood ‚Üí quarter ‚Üí municipality ‚Üí city_district`.
- `thon` (th√¥n/x√≥m/·∫•p/t·ªï): ∆∞u ti√™n `hamlet`, n·∫øu kh√¥ng c√≥ th√¨ `neighbourhood ‚Üí quarter`.
- `thanhPho` v√† alias `tinhThanh` l·∫•y t·ª´ `city` ho·∫∑c `province/state` (ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã, ch∆∞a l∆∞u DB).
- `chiTiet` lu√¥n ƒë·ªÉ tr·ªëng ƒë·ªÉ ng∆∞·ªùi d√πng nh·∫≠p s·ªë nh√†/t√≤a nh√† th·ªß c√¥ng.

Snippet frontend (JS thu·∫ßn):
```javascript
async function autofillAddressFromMap(lat, lng) {
  const url = `http://localhost:5000/api/cosoluutru/reverse-geocode?lat=${lat}&lng=${lng}`;
  const res = await fetch(url);
  const json = await res.json();
  if (!json.success) return;
  const d = json.data;
  document.querySelector('#chiTiet').value = d.chiTiet ?? '';
  document.querySelector('#pho').value = d.pho ?? '';
  // N·∫øu l√† v√πng n√¥ng th√¥n, c√≥ th·ªÉ d√πng d.thon ƒë·ªÉ hi·ªÉn th·ªã ho·∫∑c g√°n v√†o pho khi kh√¥ng c√≥ t√™n ƒë∆∞·ªùng
  if (!d.pho && d.thon) document.querySelector('#pho').value = d.thon;
  document.querySelector('#phuong').value = d.phuong ?? '';
  document.querySelector('#thanhPho').value = d.thanhPho ?? d.tinhThanh ?? '';
  document.querySelector('#nuoc').value = d.nuoc ?? 'Vi·ªát Nam';
  document.querySelector('#viDo').value = d.viDo ?? '';
  document.querySelector('#kinhDo').value = d.kinhDo ?? '';
}
```

Form create/update: c√≥ th·ªÉ g·ª≠i th√™m tr∆∞·ªùng `thon`; backend s·∫Ω d√πng `thon` l√†m alias cho `pho` n·∫øu `pho` tr·ªëng.

---

## üè† **2. QU·∫¢N L√ù PH√íNG** `/api/rooms`

### **Danh s√°ch ph√≤ng**
```http
GET /api/rooms?page=1&pageSize=20&coSoId=123&available=true&checkin=2024-01-01&checkout=2024-01-02
```
- **Filter:** Theo c∆° s·ªü, t√¨nh tr·∫°ng, ng√†y tr·ªëng

### **Chi ti·∫øt ph√≤ng**
```http
GET /api/rooms/{id}
```

### **T·∫°o ph√≤ng m·ªõi**
```http
POST /api/rooms
Content-Type: multipart/form-data
Authorization: Bearer <token>

Form data:
- tenPhong: string
- idCoSoLuuTru: int
- loaiPhong: string
- giaPhong: decimal
- moTa: string
- file: image (optional)
```

Ghi ch√∫:
- Tr∆∞·ªùng gi√° c√≥ th·ªÉ g·ª≠i b·∫±ng kh√≥a giaPhong ho·∫∑c gia (c·∫£ hai ƒë·ªÅu ƒë∆∞·ª£c ch·∫•p nh·∫≠n).
- N·∫øu g·ª≠i gi√° khi t·∫°o, h·ªá th·ªëng s·∫Ω t·∫°o m·ªôt b·∫£n ghi trong b·∫£ng GiaPhong v·ªõi NgayApDung = th·ªùi ƒëi·ªÉm hi·ªán t·∫°i.

### **C·∫≠p nh·∫≠t th√¥ng tin ph√≤ng**
```http
PUT /api/rooms/{id}
Content-Type: application/json
Authorization: Bearer <token>

{
  "tenPhong": "string",
  "loaiPhong": "string", 
  "giaPhong": decimal,
  "moTa": "string"
}
```

Ghi ch√∫:
- Tr∆∞·ªùng gi√° c√≥ th·ªÉ g·ª≠i b·∫±ng kh√≥a giaPhong ho·∫∑c gia (c·∫£ hai ƒë·ªÅu ƒë∆∞·ª£c ch·∫•p nh·∫≠n).
- Khi cung c·∫•p gi√°, API s·∫Ω KH√îNG c·∫≠p nh·∫≠t gi√° t·∫°i ch·ªó m√† s·∫Ω ch√®n TH√äM m·ªôt d√≤ng l·ªãch s·ª≠ v√†o b·∫£ng GiaPhong (gi·ªØ l·ªãch s·ª≠ gi√°). C√°c API GET s·∫Ω lu√¥n tr·∫£ v·ªÅ gi√° m·ªõi nh·∫•t c√πng NgayApDungGia.

### **Upload/C·∫≠p nh·∫≠t ·∫£nh ph√≤ng**
```http
PUT /api/rooms/{id}/image
Content-Type: multipart/form-data
Authorization: Bearer <token>

Form data:
- file: image
```

### **X√≥a ph√≤ng**
```http
DELETE /api/rooms/{id}
Authorization: Bearer <token>
```

### **X√≥a ·∫£nh ph√≤ng**
```http
DELETE /api/rooms/{id}/image
Authorization: Bearer <token>
```

---

## üìÖ **3. QU·∫¢N L√ù ƒê·∫∂T PH√íNG** `/api/bookings`

### **T·∫°o ƒë·∫∑t ph√≤ng**
```http
POST /api/bookings
Content-Type: application/json
Authorization: Bearer <token>

{
  "idPhong": int,
  "ngayNhanPhong": "2024-01-01",
  "ngayTraPhong": "2024-01-02", 
  "tongTien": decimal
}
```

### **Danh s√°ch ƒë·∫∑t ph√≤ng c·ªßa user**
```http
GET /api/bookings/user
Authorization: Bearer <token>
```

### **Chi ti·∫øt ƒë·∫∑t ph√≤ng**
```http
GET /api/bookings/{id}
Authorization: Bearer <token>
```

### **Ki·ªÉm tra t√¨nh tr·∫°ng ph√≤ng**
```http
GET /api/bookings/check-availability?idPhong=123&ngayNhanPhong=2024-01-01&ngayTraPhong=2024-01-02
```

---

## üí≥ **4. QU·∫¢N L√ù THANH TO√ÅN** `/api/payments`

### **Danh s√°ch thanh to√°n**
```http
GET /api/payments
Authorization: Bearer <token>
```

### **T·∫°o thanh to√°n VNPay**
```http
POST /api/payments/create-vnpay-payment
Content-Type: application/json
Authorization: Bearer <token>

{
  "idDatPhong": int,
  "amount": decimal,
  "orderInfo": "string"
}
```

### **VNPay callback**
```http
GET /api/payments/vnpay-return?[vnpay_params]
GET /api/payments/vnpay-ipn?[vnpay_params]
```

### **T·∫°o ho√†n ti·ªÅn**
```http
POST /api/payments/create-refund
Content-Type: application/json
Authorization: Bearer <token>

{
  "idDatPhong": int,
  "lyDoHuy": "string"
}
```

### **X√°c nh·∫≠n ho√†n ti·ªÅn**
```http
POST /api/payments/confirm-refund
Authorization: Bearer <token>

{
  "idHuyDatPhong": int
}
```

---

## üéØ **5. QU·∫¢N L√ù KHUY·∫æN M√ÉI** `/api/promotions`

### **Xem khuy·∫øn m√£i ph√≤ng**
```http
GET /api/promotions/rooms/{id}/preview
```

---

## üë§ **6. QU·∫¢N L√ù NG∆Ø·ªúI D√ôNG** `/api/user`

### **Th√¥ng tin c√° nh√¢n**
```http
GET /api/user/me
Authorization: Bearer <token>
```

### **Danh s√°ch ng∆∞·ªùi d√πng**
```http
GET /api/user?page=1&pageSize=20&q=search
```

### **C·∫≠p nh·∫≠t th√¥ng tin**
```http
PUT /api/user/profile
Content-Type: application/json
Authorization: Bearer <token>

{
  "hoTen": "string",
  "soDienThoai": "string"
}
```

### **Upload avatar**
```http
PUT /api/user/avatar
Content-Type: multipart/form-data
Authorization: Bearer <token>

Form data:
- file: image
```

### **X√≥a avatar**
```http
DELETE /api/user/avatar
Authorization: Bearer <token>
```

### **C·∫≠p nh·∫≠t vai tr√≤ (Admin only)**
```http
PATCH /api/user/{id}/role
Content-Type: application/json
Authorization: Bearer <admin_token>

{
  "vaiTro": "Admin|ChuCoSo|KhachHang"
}
```

---

## üîê **10. X√ÅC TH·ª∞C** `/api/auth`

### **ƒêƒÉng nh·∫≠p**
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "string",
  "password": "string"
}
```

### **ƒêƒÉng k√Ω**
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "string", 
  "password": "string",
  "hoTen": "string",
  "soDienThoai": "string"
}
```

---

## ÔøΩÔ∏è **8. OPENSTREETMAP INTEGRATION** `/api/maps`

### **Geocoding - Chuy·ªÉn ƒë·ªãa ch·ªâ th√†nh t·ªça ƒë·ªô**
```http
GET /api/maps/geocode?address=123%20Ph∆∞·ªùng%20Tr·∫ßn%20H∆∞ng%20ƒê·∫°o,%20Qu·∫≠n%20Ho√†n%20Ki·∫øm,%20H√†%20N·ªôi
```

**Response:**
```json
{
  "success": true,
  "data": {
    "latitude": 21.028511,
    "longitude": 105.804817,
    "displayName": "123, Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o, Qu·∫≠n Ho√†n Ki·∫øm, H√† N·ªôi, Vi·ªát Nam",
    "boundingBox": ["21.0285", "21.0286", "105.8048", "105.8049"]
  },
  "message": "Geocoding th√†nh c√¥ng"
}
```

### **Reverse Geocoding - Chuy·ªÉn t·ªça ƒë·ªô th√†nh ƒë·ªãa ch·ªâ**
```http
GET /api/maps/reverse-geocode?lat=21.028511&lon=105.804817
```

**Response:**
```json
{
  "success": true,
  "data": {
    "latitude": 21.028511,
    "longitude": 105.804817,
    "displayName": "123, Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o, Qu·∫≠n Ho√†n Ki·∫øm, H√† N·ªôi, Vi·ªát Nam",
    "address": {
      "houseNumber": "123",
      "road": "Ph·ªë Tr·∫ßn H∆∞ng ƒê·∫°o",
      "quarter": "Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o",
      "cityDistrict": "Qu·∫≠n Ho√†n Ki·∫øm",
      "city": "H√† N·ªôi",
      "province": "H√† N·ªôi",
      "country": "Vi·ªát Nam"
    }
  },
  "message": "Reverse geocoding th√†nh c√¥ng"
}
```

### **T√¨m ƒë·ªãa ƒëi·ªÉm g·∫ßn nh·∫•t**
```http
GET /api/maps/nearby?lat=21.028511&lon=105.804817&category=restaurant&radius=1000
```

**Parameters:**
- `lat`, `lon`: T·ªça ƒë·ªô trung t√¢m
- `category`: Lo·∫°i ƒë·ªãa ƒëi·ªÉm (restaurant, bank, hospital, school, shop, etc.)
- `radius`: B√°n k√≠nh t√¨m ki·∫øm (m√©t, max 50000)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "name": "Nh√† h√†ng ABC",
      "latitude": 21.029,
      "longitude": 105.805,
      "distance": 150.5,
      "type": "restaurant",
      "class": "amenity"
    }
  ],
  "total": 1,
  "message": "T√¨m th·∫•y 1 ƒë·ªãa ƒëi·ªÉm trong b√°n k√≠nh 1000m"
}
```

### **L·∫•y danh s√°ch c∆° s·ªü l∆∞u tr√∫ cho map**
```http
GET /api/maps/accommodations?status=DaDuyet
```

**Parameters:**
- `status`: Tr·∫°ng th√°i (DaDuyet, ChoDuyet, ho·∫∑c b·ªè tr·ªëng ƒë·ªÉ l·∫•y t·∫•t c·∫£)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenCoSo": "Hotel ABC",
      "latitude": 21.028511,
      "longitude": 105.804817,
      "diaChi": "123, Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o, Qu·∫≠n Ho√†n Ki·∫øm, H√† N·ªôi",
      "trangThaiDuyet": "DaDuyet",
      "anhUrl": "/api/static/uploads/accommodations/hotel1.jpg",
      "moTa": "Kh√°ch s·∫°n 3 sao v·ªõi ƒë·∫ßy ƒë·ªß ti·ªán nghi"
    }
  ],
  "total": 1,
  "message": "L·∫•y danh s√°ch c∆° s·ªü l∆∞u tr√∫ th√†nh c√¥ng"
}
```

### **T√≠nh kho·∫£ng c√°ch gi·ªØa 2 ƒëi·ªÉm**
```http
GET /api/maps/distance?lat1=21.028511&lon1=105.804817&lat2=21.0245&lon2=105.8412
```

**Response:**
```json
{
  "success": true,
  "data": {
    "distance": 4236.84,
    "unit": "meters",
    "distanceKm": 4.24,
    "from": { "latitude": 21.028511, "longitude": 105.804817 },
    "to": { "latitude": 21.0245, "longitude": 105.8412 }
  },
  "message": "T√≠nh kho·∫£ng c√°ch th√†nh c√¥ng"
}
```

### **G·ª£i √Ω ƒë·ªãa ch·ªâ (Autocomplete)**
```http
GET /api/maps/suggest?query=Tr·∫ßn%20H∆∞ng&limit=5
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "displayName": "Ph·ªë Tr·∫ßn H∆∞ng ƒê·∫°o, Qu·∫≠n Ho√†n Ki·∫øm, H√† N·ªôi",
      "latitude": 21.028511,
      "longitude": 105.804817,
      "type": "highway",
      "class": "primary"
    }
  ],
  "total": 1,
  "message": "T√¨m th·∫•y 1 g·ª£i √Ω"
}
```

---

## ÔøΩüñºÔ∏è **9. QU·∫¢N L√ù FILE Tƒ®NH** `/api/static`

### **Xem ·∫£nh avatar**
```http
GET /api/static/avatars/{fileName}
```

### **Xem file upload**
```http
GET /api/static/uploads/{category}/{fileName}
```
- **category:** avatars, rooms, accommodations

---

## üìã **EXAMPLES**

### **JavaScript Frontend Usage**

#### **1. ƒêƒÉng nh·∫≠p v√† l·∫•y token**
```javascript
// ƒêƒÉng nh·∫≠p
const loginResponse = await fetch('http://localhost:5000/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        email: 'user@example.com',
        password: 'password123'
    })
});
const { data } = await loginResponse.json();
const token = data.accessToken;

// L∆∞u token
localStorage.setItem('token', token);
```

#### **2. L·∫•y th√¥ng tin ng∆∞·ªùi d√πng**
```javascript
const userResponse = await fetch('http://localhost:5000/api/user/me', {
    headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
});
const userData = await userResponse.json();
```

#### **3. Upload avatar**
```javascript
const uploadAvatar = async (file) => {
    const formData = new FormData();
    formData.append('file', file);
    
    const response = await fetch('http://localhost:5000/api/user/avatar', {
        method: 'PUT',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: formData
    });
    
    return await response.json();
};
```

#### **4. T·∫°o c∆° s·ªü l∆∞u tr√∫ m·ªõi**
```javascript
const createAccommodation = async (accommodationData, imageFile) => {
    const formData = new FormData();
    formData.append('tenCoSo', accommodationData.tenCoSo);
    formData.append('moTa', accommodationData.moTa);
    formData.append('soTaiKhoan', accommodationData.soTaiKhoan);
    formData.append('tenTaiKhoan', accommodationData.tenTaiKhoan);
    formData.append('tenNganHang', accommodationData.tenNganHang);
    formData.append('idDiaChi', accommodationData.idDiaChi);
    if (imageFile) formData.append('file', imageFile);
    
    const response = await fetch('http://localhost:5000/api/cosoluutru', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: formData
    });
    
    return await response.json();
};

// C·∫≠p nh·∫≠t c∆° s·ªü l∆∞u tr√∫
const updateAccommodation = async (id, accommodationData, imageFile) => {
    const formData = new FormData();
    formData.append('tenCoSo', accommodationData.tenCoSo);
    formData.append('moTa', accommodationData.moTa);
    formData.append('soTaiKhoan', accommodationData.soTaiKhoan);
    formData.append('tenTaiKhoan', accommodationData.tenTaiKhoan);
    formData.append('tenNganHang', accommodationData.tenNganHang);
    formData.append('idDiaChi', accommodationData.idDiaChi);
    if (imageFile) formData.append('file', imageFile);
    
    const response = await fetch(`http://localhost:5000/api/cosoluutru/${id}`, {
        method: 'PUT',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: formData
    });
    
    return await response.json();
};

// X√≥a c∆° s·ªü l∆∞u tr√∫
const deleteAccommodation = async (id) => {
    const response = await fetch(`http://localhost:5000/api/cosoluutru/${id}`, {
        method: 'DELETE',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
    });
    
    return await response.json();
};
```

#### **5. L·∫•y danh s√°ch ph√≤ng**
```javascript
const getRooms = async (coSoId, page = 1, pageSize = 20) => {
    const response = await fetch(
        `http://localhost:5000/api/rooms?coSoId=${coSoId}&page=${page}&pageSize=${pageSize}`
    );
    return await response.json();
};
```

#### **6. T·∫°o ph√≤ng m·ªõi**
```javascript
const createRoom = async (roomData, imageFile) => {
    const formData = new FormData();
    formData.append('tenPhong', roomData.tenPhong);
    formData.append('idCoSoLuuTru', roomData.idCoSoLuuTru);
    formData.append('loaiPhong', roomData.loaiPhong);
    formData.append('giaPhong', roomData.giaPhong);
    formData.append('moTa', roomData.moTa);
    if (imageFile) formData.append('file', imageFile);
    
    const response = await fetch('http://localhost:5000/api/rooms', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: formData
    });
    
    return await response.json();
};
```

#### **7. ƒê·∫∑t ph√≤ng**
```javascript
const bookRoom = async (idPhong, ngayNhanPhong, ngayTraPhong, tongTien) => {
    const response = await fetch('http://localhost:5000/api/bookings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({
            idPhong,
            ngayNhanPhong,
            ngayTraPhong,
            tongTien
        })
    });
    
    return await response.json();
};
```

---

## üöÄ **Quick Start cho Frontend**

### **1. Setup API Service**
```javascript
class HotelAPI {
    constructor() {
        this.baseURL = 'http://localhost:5000';
        this.token = localStorage.getItem('token');
    }
    
    setToken(token) {
        this.token = token;
        localStorage.setItem('token', token);
    }
    
    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        const config = {
            headers: {
                ...options.headers,
                ...(this.token && { 'Authorization': `Bearer ${this.token}` })
            },
            ...options
        };
        
        const response = await fetch(url, config);
        return await response.json();
    }
    
    // Auth
    async login(email, password) {
        return this.request('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
    }
    
    // User
    async getMe() {
        return this.request('/api/user/me');
    }
    
    // Rooms
    async getRooms(params = {}) {
        const query = new URLSearchParams(params).toString();
        return this.request(`/api/rooms${query ? '?' + query : ''}`);
    }
    
    // Accommodations v·ªõi ƒë·ªãa ch·ªâ
    async createAccommodationWithAddress(data, imageFile = null) {
        const formData = new FormData();
        
        // Th√¥ng tin c∆° s·ªü
        formData.append('tenCoSo', data.tenCoSo);
        formData.append('moTa', data.moTa || '');
        formData.append('soTaiKhoan', data.soTaiKhoan || '');
        formData.append('tenTaiKhoan', data.tenTaiKhoan || '');
        formData.append('tenNganHang', data.tenNganHang || '');
        
        // Th√¥ng tin ƒë·ªãa ch·ªâ
        formData.append('soNha', data.soNha || '');
        formData.append('phuong', data.phuong || '');
        formData.append('quan', data.quan || '');
        formData.append('thanhPho', data.thanhPho);
        
        if (data.kinhDo) formData.append('kinhDo', data.kinhDo.toString());
        if (data.viDo) formData.append('viDo', data.viDo.toString());
        
        // ·∫¢nh (n·∫øu c√≥)
        if (imageFile) {
            formData.append('file', imageFile);
        }
        
        return this.request('/api/cosoluutru', {
            method: 'POST',
            body: formData
        });
    }

    // Bookings
    async createBooking(bookingData) {
        return this.request('/api/bookings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bookingData)
        });
    }
}

// S·ª≠ d·ª•ng
const api = new HotelAPI();
```

### **2. Usage Example**
```javascript
// ƒêƒÉng nh·∫≠p
const loginResult = await api.login('user@example.com', 'password');
if (loginResult.success) {
    api.setToken(loginResult.data.accessToken);
}

// L·∫•y th√¥ng tin user
const user = await api.getMe();

// L·∫•y danh s√°ch ph√≤ng
const rooms = await api.getRooms({ coSoId: 1, page: 1 });

// T·∫°o c∆° s·ªü l∆∞u tr√∫ v·ªõi ƒë·ªãa ch·ªâ m·ªõi
const accommodationData = {
    tenCoSo: 'Hotel ABC',
    moTa: 'Kh√°ch s·∫°n 3 sao t·∫°i trung t√¢m th√†nh ph·ªë',
    soTaiKhoan: '1234567890',
    tenTaiKhoan: 'Nguyen Van A',  
    tenNganHang: 'Vietcombank',
    soNha: '123',
    phuong: 'Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o',
    quan: 'Qu·∫≠n Ho√†n Ki·∫øm',
    thanhPho: 'H√† N·ªôi',
    kinhDo: 21.028511,
    viDo: 105.804817
};

const imageFile = document.getElementById('imageInput').files[0];
const accommodation = await api.createAccommodationWithAddress(accommodationData, imageFile);

// ƒê·∫∑t ph√≤ng
const booking = await api.createBooking({
    idPhong: 1,
    ngayNhanPhong: '2024-01-01',
    ngayTraPhong: '2024-01-02',
    tongTien: 1000000
});
```

## üìã Reference Data APIs

### **L·∫•y danh s√°ch lo·∫°i ph√≤ng**
```http
GET /api/reference/room-types
```

### **L·∫•y danh s√°ch t·ªânh/th√†nh ph·ªë**
```http
GET /api/reference/provinces
```

### **L·∫•y tr·∫°ng th√°i c∆° s·ªü l∆∞u tr√∫**
```http
GET /api/reference/accommodation-statuses
```

### **Qu·∫£n l√Ω ƒë·ªãa ch·ªâ chi ti·∫øt**

#### L·∫•y danh s√°ch ƒë·ªãa ch·ªâ
```http
GET /api/reference/addresses
```

#### T·∫°o ƒë·ªãa ch·ªâ m·ªõi
```http
POST /api/reference/addresses
Content-Type: application/json

{
  "soNha": "123",
  "phuong": "Ph∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o", 
  "quan": "Qu·∫≠n Ho√†n Ki·∫øm",
  "thanhPho": "H√† N·ªôi",
  "kenhDo": 21.028511,
  "viDo": 105.804817
}
```

#### C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ
```http
PUT /api/reference/addresses/{id}
Content-Type: application/json

{
  "soNha": "456",
  "phuong": "Ph∆∞·ªùng Tr√†ng Ti·ªÅn",
  "quan": "Qu·∫≠n Ho√†n Ki·∫øm", 
  "thanhPho": "H√† N·ªôi",
  "kenhDo": 21.028511,
  "viDo": 105.804817
}
```

#### X√≥a ƒë·ªãa ch·ªâ
```http
DELETE /api/reference/addresses/{id}
```

### **L·∫•y d·ªØ li·ªáu ƒë·ªãa ch·ªâ theo c·∫•p**

#### L·∫•y danh s√°ch t·ªânh/th√†nh ph·ªë
```http
GET /api/reference/cities
```

#### L·∫•y danh s√°ch qu·∫≠n/huy·ªán
```http
GET /api/reference/districts
GET /api/reference/districts?thanhPho=H√† N·ªôi
```

#### L·∫•y danh s√°ch ph∆∞·ªùng/x√£
```http
GET /api/reference/wards
GET /api/reference/wards?thanhPho=H√† N·ªôi
GET /api/reference/wards?thanhPho=H√† N·ªôi&quan=Qu·∫≠n Ho√†n Ki·∫øm
```

### **L·∫•y danh s√°ch ng√¢n h√†ng**
```http
GET /api/reference/banks
```

## üîß JavaScript Helper cho Dropdown ƒê·ªãa ch·ªâ

```javascript
class AddressSelector {
  constructor(baseUrl = 'https://your-api.com/api/reference') {
    this.baseUrl = baseUrl;
  }
  
  async loadCities(selectElement) {
    try {
      const response = await fetch(`${this.baseUrl}/cities`);
      const result = await response.json();
      
      selectElement.innerHTML = '<option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>';
      result.data.forEach(item => {
        selectElement.innerHTML += `<option value="${item.ThanhPho}">${item.ThanhPho}</option>`;
      });
    } catch (error) {
      console.error('L·ªói t·∫£i danh s√°ch th√†nh ph·ªë:', error);
    }
  }
  
  async loadDistricts(selectElement, thanhPho) {
    const url = thanhPho ? 
      `${this.baseUrl}/districts?thanhPho=${encodeURIComponent(thanhPho)}` : 
      `${this.baseUrl}/districts`;
    
    const response = await fetch(url);
    const result = await response.json();
    
    selectElement.innerHTML = '<option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>';
    result.data.forEach(item => {
      selectElement.innerHTML += `<option value="${item.Quan}">${item.Quan}</option>`;
    });
  }
  
  async loadWards(selectElement, thanhPho, quan) {
    const params = new URLSearchParams();
    if (thanhPho) params.append('thanhPho', thanhPho);
    if (quan) params.append('quan', quan);
    
    const url = `${this.baseUrl}/wards${params.toString() ? '?' + params.toString() : ''}`;
    const response = await fetch(url);
    const result = await response.json();
    
    selectElement.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
    result.data.forEach(item => {
      selectElement.innerHTML += `<option value="${item.Phuong}">${item.Phuong}</option>`;
    });
  }
  
  async createAddress(addressData) {
    const response = await fetch(`${this.baseUrl}/addresses`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(addressData)
    });
    return await response.json();
  }
}

// S·ª≠ d·ª•ng Address Selector
const addressSelector = new AddressSelector();
const citySelect = document.getElementById('citySelect');
const districtSelect = document.getElementById('districtSelect');
const wardSelect = document.getElementById('wardSelect');

// Load cities khi trang load
addressSelector.loadCities(citySelect);

// Cascade dropdown
citySelect.addEventListener('change', (e) => {
  const selectedCity = e.target.value;
  if (selectedCity) {
    addressSelector.loadDistricts(districtSelect, selectedCity);
    wardSelect.innerHTML = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';
  }
});

districtSelect.addEventListener('change', (e) => {
  const selectedDistrict = e.target.value;
  const selectedCity = citySelect.value;
  if (selectedDistrict && selectedCity) {
    addressSelector.loadWards(wardSelect, selectedCity, selectedDistrict);
  }
});
```

ƒê√¢y l√† b·ªô API documentation ho√†n ch·ªânh ƒë·ªÉ b·∫°n ph√°t tri·ªÉn frontend! üéâ